<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Dish - Bangola Restaurant</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-container">Bangola Exquisite African Restaurant</div>
        <nav>
            <ul>
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="menu.html" class="nav-link">Menu</a></li>
                <li><a href="add-dish.html" class="nav-link active">Add Dish</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <div class="flex-wrap">
            <h1>Add Your Dish to the Kingdom</h1>
            
            <form id="add-dish-form" class="dish-form">
                <div class="form-group">
                    <label for="dish-name">Dish Name:</label>
                    <input type="text" id="dish-name" name="dish-name" placeholder="e.g. Nyama Choma, Jollof Rice..." required>
                </div>
                
                <div class="form-group">
                    <label for="dish-description">DESCRIPTION - Describe the dish – flavour, tradition, occasion…</label>
                    <textarea id="dish-description" name="dish-description" rows="4" 
                        placeholder="Describe the flavours, cultural significance, when it's typically eaten..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="dish-traditions">Traditions:</label>
                    <input type="text" id="dish-traditions" name="dish-traditions" 
                        placeholder="e.g. Wedding feast, Harvest celebration, Daily meal...">
                </div>
                
                <div class="form-group">
                    <label for="dish-occasion">Occasion:</label>
                    <select id="dish-occasion" name="dish-occasion">
                        <option value="Any">Any occasion</option>
                        <option value="Wedding">Wedding</option>
                        <option value="Festival">Festival</option>
                        <option value="Daily meal">Daily meal</option>
                        <option value="Celebration">Celebration</option>
                        <option value="Religious">Religious ceremony</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group half">
                        <label for="dish-price">PRICE:</label>
                        <input type="text" id="dish-price" name="dish-price" 
                            placeholder="e.g. 85, 400" required>
                    </div>
                    
                    <div class="form-group half">
                        <label for="dish-currency">Currency:</label>
                        <select id="dish-currency" name="dish-currency" required>
                            <option value="USD">USD ($)</option>
                            <option value="KES">KES (KSh)</option>
                            <option value="ZAR">ZAR (R)</option>
                            <option value="BTC">BTC (Bitcoin) ₿</option>
                            <option value="NGN">NGN (₦)</option>
                            <option value="GHS">GHS (₵)</option>
                        </select>
                    </div>
                </div>
                
                <div class="price-examples">
                    <small>Examples:  KSh 400, ₿ 0.00015, $12.50</small>
                </div>
                
                <button type="submit" class="submit-btn">Add your dish to the kingdom</button>
            </form>
            
            <div class="recent-preview">
                <h3>Recently added</h3>
                <div id="preview-dishes" class="mini-grid">
                    <!-- Recent dishes will be rendered here by JavaScript -->
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>Bangola Kingdom Restaurant — taste the motherland, every bite tells a story.</p>
        <p>© 2026 | Heritage on a plate</p>
    </footer>

    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
  <script>
    // Function to load and display recently added dishes
    window.loadRecentlyAdded = function() {
        const container = document.getElementById('recently-added-dishes');
        if (!container) return;
        
        container.innerHTML = '';
        
        try {
            const dishes = JSON.parse(localStorage.getItem('bangolaDishes')) || [];
            console.log('Loading recent dishes:', dishes.length);
            
            if (!dishes || dishes.length === 0) {
                container.innerHTML = '<p class="no-dishes">0 dishes saved</p>';
                return;
            }
            
            // Get the 3 most recent dishes
            const recentDishes = [...dishes].sort((a, b) => b.id - a.id).slice(0, 3);
            
            recentDishes.forEach(dish => {
                const card = document.createElement('div');
                card.className = 'mini-card';
                
                // Format price with currency
                let priceDisplay = '';
                switch(dish.currency) {
                    case 'BTC':
                        priceDisplay = `₿ ${dish.price} BTC`;
                        break;
                    case 'KES':
                        priceDisplay = `KSh ${dish.price}`;
                        break;
                    case 'ZAR':
                        priceDisplay = `R ${dish.price}`;
                        break;
                    case 'USD':
                        priceDisplay = `$${dish.price} USD`;
                        break;
                    case 'NGN':
                        priceDisplay = `₦ ${dish.price}`;
                        break;
                    case 'GHS':
                        priceDisplay = `₵ ${dish.price}`;
                        break;
                    default:
                        priceDisplay = `$${dish.price}`;
                }
                
                card.innerHTML = `
                    <strong>${dish.name || 'Untitled'}</strong>
                    <span>${priceDisplay}</span>
                    <small>${dish.occasion || 'Any occasion'}</small>
                    <button onclick="deleteDish(${dish.id}); return false;" class="mini-delete">×</button>
                `;
                container.appendChild(card);
            });
            
        } catch (error) {
            console.error('Error loading recent dishes:', error);
            container.innerHTML = '<p class="no-dishes">Error loading dishes</p>';
        }
    };
    
    // Handle form submission
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Add dish page loaded');
        
        const form = document.getElementById('add-dish-form');
        if (form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form values
                const dish = {
                    id: Date.now(), // Use timestamp as unique ID
                    name: document.getElementById('dish-name')?.value || '',
                    description: document.getElementById('dish-description')?.value || '',
                    tradition: document.getElementById('dish-traditions')?.value || 'Traditional dish',
                    occasion: document.getElementById('dish-occasion')?.value || 'Any occasion',
                    price: document.getElementById('dish-price')?.value || '',
                    currency: document.getElementById('dish-currency')?.value || 'USD',
                    dateAdded: new Date().toISOString()
                };
                
                console.log('Saving dish:', dish);
                
                try {
                    // Get existing dishes
                    let dishes = JSON.parse(localStorage.getItem('bangolaDishes')) || [];
                    
                    // Add new dish
                    dishes.push(dish);
                    
                    // Save back to localStorage
                    localStorage.setItem('bangolaDishes', JSON.stringify(dishes));
                    
                    alert('Dish added successfully!');
                    form.reset();
                    
                    // Refresh displays
                    loadRecentlyAdded();
                    if (typeof renderLocalDishes === 'function') {
                        renderLocalDishes('local-dishes-home');
                    }
                    
                } catch (error) {
                    console.error('Error saving dish:', error);
                    alert('Error adding dish. Please try again.');
                }
            });
        }
        
        // Load recently added dishes
        loadRecentlyAdded();
        
        // Set active nav if function exists
        if (typeof setActiveNav === 'function') {
            setActiveNav('add-dish.html');
        }
    });
</script>
</body>
</html>